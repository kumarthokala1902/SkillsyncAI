{% extends "base.html" %}

{% block content %}
<div class="w-full py-8 px-8 relative z-10">
    <!-- Header Section -->
    <div class="card-dark rounded-2xl p-8 mb-8 hover-lift">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-4xl font-bold text-white mb-3">
                    <span class="gradient-text">Your Skill Progress</span>
                </h1>
                <p class="text-xl text-gray-400">Track your growth journey with detailed insights and analytics</p>
            </div>
            <div class="text-right">
                <div class="glass-effect rounded-2xl p-6 text-center">
                    <p class="text-sm text-gray-400 mb-2">Total Skills Tracked</p>
                    <p class="font-bold text-white text-3xl">{{ skill_progress|length }}</p>
                    <div class="w-16 h-1 bg-gradient-to-r from-purple-500 to-pink-600 rounded-full mx-auto mt-3"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Progress Chart Section -->
    <div class="card-dark rounded-2xl p-8 mb-8 hover-lift">
        <div class="flex items-center justify-between mb-8">
            <h2 class="text-2xl font-bold text-white">
                <i class="fas fa-chart-bar text-purple-400 mr-4 text-3xl"></i>
                Progress Overview
            </h2>
            <div class="flex items-center space-x-4">
                <span class="glass-effect text-purple-300 text-sm font-medium px-4 py-2 rounded-xl">
                    {{ skill_progress|length }} Skills
                </span>
                <button class="glass-effect text-gray-300 hover:text-white transition duration-300 px-4 py-2 rounded-xl">
                    <i class="fas fa-download mr-2"></i>Export
                </button>
            </div>
        </div>
        <div class="p-6 glass-effect rounded-2xl">
            <canvas id="progressChart" height="120"></canvas>
        </div>
    </div>

    <!-- Skill Details Section -->
    <div class="card-dark rounded-2xl p-8 hover-lift">
        <div class="flex items-center justify-between mb-8">
            <h2 class="text-2xl font-bold text-white">
                <i class="fas fa-tasks text-blue-400 mr-4 text-3xl"></i>
                Skill Details
            </h2>
            <span class="glass-effect text-blue-300 text-sm font-medium px-4 py-2 rounded-xl">
                {{ skill_progress|length }} Active Skills
            </span>
        </div>

        {% if skill_progress %}
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            {% for skill in skill_progress %}
            <div class="glass-effect rounded-2xl p-6 hover:bg-white/5 transition-all duration-500 group">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-star text-white text-lg"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-white text-lg group-hover:text-purple-300 transition duration-300">
                                {{ skill.skill_name }}
                            </h3>
                            <p class="text-gray-400 text-sm">Skill Level</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="text-2xl font-bold text-purple-400">{{ "%.0f"|format(skill.level * 100) }}%</span>
                        <p class="text-gray-500 text-xs mt-1">Current Progress</p>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-gray-400">Progress</span>
                        <span class="text-sm text-gray-400">{{ "%.0f"|format(skill.level * 100) }}%</span>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-3">
                        <div class="bg-gradient-to-r from-purple-500 to-pink-600 h-3 rounded-full transition-all duration-1000 ease-out" 
                             style="width: {{ skill.level * 100 }}%"></div>
                    </div>
                </div>

                <!-- Additional Info -->
                <div class="flex items-center justify-between text-sm text-gray-500 mb-4">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-calendar text-blue-400"></i>
                        <span>Updated {{ skill.last_updated.strftime('%b %d, %Y') }}</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-clock text-green-400"></i>
                        <span>{{ skill.last_updated.strftime('%I:%M %p') }}</span>
                    </div>
                </div>

                <!-- Action Button -->
                <button onclick="updateProgress({{ skill.id }})" 
                        class="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-3 px-4 rounded-xl text-sm font-medium hover:from-green-600 hover:to-green-700 transition-all duration-300 transform hover:scale-105 group">
                    <i class="fas fa-arrow-up mr-2 group-hover:animate-bounce"></i>
                    Add 10% Progress
                </button>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <!-- Empty State -->
        <div class="text-center py-12">
            <div class="w-24 h-24 bg-gradient-to-r from-purple-500/20 to-pink-600/20 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-chart-line text-purple-400 text-4xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-gray-400 mb-2">No Skills Tracked Yet</h3>
            <p class="text-gray-500 text-lg mb-6">Start tracking your skill progress to see your growth journey</p>
            <a href="{{ url_for('dashboard') }}" 
               class="inline-flex items-center space-x-2 bg-gradient-to-r from-purple-500 to-pink-600 text-white py-3 px-6 rounded-xl text-sm font-medium hover:from-purple-600 hover:to-pink-700 transition-all duration-300">
                <i class="fas fa-plus"></i>
                <span>Add Skills to Profile</span>
            </a>
        </div>
        {% endif %}
    </div>

    <!-- Quick Stats Section -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mt-8">
        <div class="card-dark rounded-2xl p-6 text-center hover-lift">
            <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-bullseye text-white text-2xl"></i>
            </div>
            <h3 class="text-lg font-bold text-white mb-2">Average Progress</h3>
            <p class="text-3xl font-bold text-blue-400">
                {% if skill_progress %}
                    {{ "%.0f"|format((skill_progress|map(attribute='level')|sum / skill_progress|length * 100)) }}%
                {% else %}
                    0%
                {% endif %}
            </p>
        </div>
        
        <div class="card-dark rounded-2xl p-6 text-center hover-lift">
            <div class="w-16 h-16 bg-gradient-to-r from-green-500 to-green-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-check-circle text-white text-2xl"></i>
            </div>
            <h3 class="text-lg font-bold text-white mb-2">Skills > 80%</h3>
            <p class="text-3xl font-bold text-green-400">
                {{ skill_progress|selectattr('level', '>=', 0.8)|list|length }}
            </p>
        </div>
        
        <div class="card-dark rounded-2xl p-6 text-center hover-lift">
            <div class="w-16 h-16 bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-clock text-white text-2xl"></i>
            </div>
            <h3 class="text-lg font-bold text-white mb-2">In Progress</h3>
            <p class="text-3xl font-bold text-yellow-400">
                {{ skill_progress|selectattr('level', '>=', 0.2)|selectattr('level', '<', 0.8)|list|length }}
            </p>
        </div>
        
        <div class="card-dark rounded-2xl p-6 text-center hover-lift">
            <div class="w-16 h-16 bg-gradient-to-r from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-flag text-white text-2xl"></i>
            </div>
            <h3 class="text-lg font-bold text-white mb-2">Just Started</h3>
            <p class="text-3xl font-bold text-purple-400">
                {{ skill_progress|selectattr('level', '<', 0.2)|list|length }}
            </p>
        </div>
    </div>
</div>

<script>
async function loadProgressChart() {
    const response = await fetch('{{ url_for("progress_data") }}');
    const data = await response.json();
    
    const ctx = document.getElementById('progressChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: data.labels,
            datasets: [{
                label: 'Skill Level (%)',
                data: data.values,
                backgroundColor: 'rgba(139, 92, 246, 0.8)',
                borderColor: 'rgba(139, 92, 246, 1)',
                borderWidth: 2,
                borderRadius: 8,
                borderSkipped: false,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: {
                        color: '#9CA3AF',
                        font: {
                            size: 14
                        }
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(17, 24, 39, 0.9)',
                    titleColor: '#E5E7EB',
                    bodyColor: '#E5E7EB',
                    borderColor: 'rgba(139, 92, 246, 0.5)',
                    borderWidth: 1
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100,
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: '#9CA3AF',
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                },
                x: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: '#9CA3AF'
                    }
                }
            },
            animation: {
                duration: 2000,
                easing: 'easeOutQuart'
            }
        }
    });
}

async function updateProgress(skillId) {
    const button = event.target;
    const originalText = button.innerHTML;
    
    // Show loading state
    button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Updating...';
    button.disabled = true;
    
    try {
        const response = await fetch(`/update-progress/${skillId}`, {
            method: 'POST'
        });
        
        if (response.ok) {
            // Show success state
            button.innerHTML = '<i class="fas fa-check mr-2"></i>Updated!';
            button.classList.remove('from-green-500', 'to-green-600', 'hover:from-green-600', 'hover:to-green-700');
            button.classList.add('from-blue-500', 'to-blue-600');
            
            // Reload after a short delay
            setTimeout(() => {
                location.reload();
            }, 1000);
        } else {
            throw new Error('Update failed');
        }
    } catch (error) {
        // Show error state
        button.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i>Error';
        button.classList.remove('from-green-500', 'to-green-600', 'hover:from-green-600', 'hover:to-green-700');
        button.classList.add('from-red-500', 'to-red-600');
        
        // Reset after delay
        setTimeout(() => {
            button.innerHTML = originalText;
            button.disabled = false;
            button.classList.remove('from-red-500', 'to-red-600');
            button.classList.add('from-green-500', 'to-green-600', 'hover:from-green-600', 'hover:to-green-700');
        }, 2000);
    }
}

// Initialize chart when page loads
document.addEventListener('DOMContentLoaded', function() {
    loadProgressChart();
});
</script>

<style>
.card-dark {
    background: rgba(23, 25, 35, 0.95);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.08);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.glass-effect {
    background: rgba(255, 255, 255, 0.03);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.05);
}

.hover-lift:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.gradient-text {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}
</style>
{% endblock %}